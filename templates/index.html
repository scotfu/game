<!DOCTYPE HTML>
<html>
<head>
<link rel="stylesheet" href="static/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="static/css/bootstrap-theme.min.css">

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Game</title>

</head>
<body>
<h1 class="text-center">Game</h1>
<div class="container">
<h4>Group:{{group_id}}</h4>
<h4> {{player}} &nbsp Round:{{g_round}}</h4>
<h3 class="timer text-center">Time: 20 seconds left</h3>

<div class="row ">
<div class="progress progress-striped active">
  <div class="progress-bar"  role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
    <span class="sr-only">45% Complete</span>
  </div>
</div>
</div>

<div class="center-block row">
<div class="btn-group" data-toggle="buttons">
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/1.png" alt="Shape 1" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current">
<img src="static/images/2.png" alt="Shape 2" height="68" width="68" style="opacity: 0.9;">
  </label> 
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/3.png" alt="Shape 3" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/4.png" alt="Shape 4" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current">
<img src="static/images/5.png" alt="Shape 5" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/6.png" alt="Shape 6" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/7.png" alt="Shape 7" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/8.png" alt="Shape 8" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/9.png" alt="Shape 9" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/10.png" alt="Shape 10" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/11.png" alt="Shape 11" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox" class="current"> 
<img src="static/images/12.png" alt="Shape 12" height="68" width="68" style="opacity: 0.9;">
  </label>
</div>
</div>

<h3 class="text-center">Scores</h3>
<div class="table-responsive">
<table id="scores" class="table table-bordered">
<tr><th>Player</th><th>Result</th><th>Score</th>

<!-- On cells (`td` or `th`) -->
<tr>
  <td class="active">{{player}}</td>
  <td class="success">None</td>
  <td class="warning">None</td>

</tr>
</table>
</div>


<div class="btn-group others" data-toggle="buttons" style="display:none">
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/1.png" alt="Shape 1" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox">
<img src="static/images/2.png" alt="Shape 2" height="68" width="68" style="opacity: 0.9;">
  </label> 
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/3.png" alt="Shape 3" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/4.png" alt="Shape 4" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox">
<img src="static/images/5.png" alt="Shape 5" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/6.png" alt="Shape 6" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/7.png" alt="Shape 7" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/8.png" alt="Shape 8" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/9.png" alt="Shape 9" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/10.png" alt="Shape 10" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/11.png" alt="Shape 11" height="68" width="68" style="opacity: 0.9;">
  </label>
  <label class="btn btn-default">
    <input type="checkbox"> 
<img src="static/images/12.png" alt="Shape 12" height="68" width="68" style="opacity: 0.9;">
  </label>
</div>





 {% csrf_token %}
</div><!--container -->
<script src="static/js/jquery.min.js"></script>
<script src="static/js/bootstrap.min.js"></script>



<script type="text/javascript">
pre_time_limit = 1.0;
time_limit=1.0;
width=0;
augment= 100.0/time_limit;
READY = "false"

function pull(){

$.ajax({
  type: "GET",
  url: "record/pull/",
  data: {"group_id":"{{group_id}}",
         "player":"{{player}}", 
         "g_round":"{{g_round}}",
         //"csrfmiddlewaretoken":$("input[name=csrfmiddlewaretoken]").val(),
},
  success: function(data) {


$(".others .btn-default").each(function (index){
 console.log(index);
if(data["records"][0]["result"][index]=="1"){
 $(this).addClass("active");
}

})
$(".others").show();
        
$.each(data["records"],function(index,record){
$("#scores tr:last").after("<tr><td>"+ record["player"] +"</td><td>"+ record["result"] + "</td><td>None</td></tr>");})
//alert(data)
            },
  error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
,
  dataType: "json",
});


}



function pre_timer(){
if(pre_time_limit>=0){
$(".timer").html("The game will start in : "+ pre_time_limit.toString()+" seconds");
pre_time_limit--;
setTimeout("pre_timer()",1000);
}
else{
timer();
pro_bar();

}
}









function timer(){
if(time_limit>=0){
$(".timer").html("Time: "+ time_limit.toString()+" seconds left");

//width_value = "width:"+ width.toString() +"%";
//width = width + augment;
//$(".progress-bar").attr("style",width_value);
time_limit--;
setTimeout("timer()",1000);
}
else{
$(".timer").html("Time is up");
$(".btn-default").addClass("disabled");
result = "";

$('input[type=checkbox].current').each(function () {
    var sThisVal = (this.checked ? "1" : "0");
    result = result.concat(sThisVal);
});
$(".success").html(result);
$(".warning").html("TBD");
//post data to the server

$.ajax({
  type: "POST",
  url: "record/push/",
  data: {"result":result,
         "player":"{{player}}", 
         "g_round":"{{g_round}}",
         "csrfmiddlewaretoken":$("input[name=csrfmiddlewaretoken]").val(),
},
  success: function(data) {              
//alert(data)
         pull();
            },
  error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
,
  dataType: "json",
});




}
}

function pro_bar(){
if(time_limit>-1){
width = width + augment/10.0;
width_value = "width:"+ width.toString() +"%";

$(".progress-bar").attr("style",width_value);

setTimeout("pro_bar()",100);
}
else{
$(".progress-bar").attr("style","width:100%");
}
}


function player_status(){
if(READY == "false"){
$.ajax({
  type: "GET",
  url: "/player_status/",
  data: {
         "player":"{{player}}", 
         "group_id":"{{group_id}}",
         "csrfmiddlewaretoken":$("input[name=csrfmiddlewaretoken]").val(),
},
  success: function(data) {
            if(data["result"]=="true"){
               READY="true";

               pre_timer();
             }
else{
$(".timer").html(data["msg"]);
}

            },
  error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
,
  dataType: "json",
});

setTimeout("player_status()",1000);

}

else{


}
}


$(document).ready(function() {
player_status();




})

</script> 

</body>
</html>
